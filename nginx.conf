worker_processes 1;                 # Сколько процессов Nginx запустится (для маленького сервера хватает 1)

events {
    worker_connections 1024;        # Максимум одновременных соединений на один процесс
}

http {                              # Основной HTTP-блок (внутри него все настройки серверов)
    include mime.types;             # Файл со списком типов файлов для правильных Content-Type
    default_type application/octet-stream;  # Тип по умолчанию, если Nginx не знает расширение

    sendfile on;                    # Быстрая отправка файлов через sendfile() — ускоряет отдачу статики
    keepalive_timeout 65;           # Время удержания соединения открытым (в секундах)

    gzip on;                        # Включаем gzip-сжатие ответов
    gzip_types application/javascript text/css text/html;  
                                     # Какие типы файлов Nginx будет сжимать
    gzip_comp_level 6;               # Степень сжатия (6 — оптимально)

    server {                         # Начало блока сервера
        listen 80;                   # Слушаем порт 80 — сюда приходит пользователь
        server_name _;               # Любое имя хоста подходит (подходит для контейнеров)

        location / {                 # Обработка корневого пути "/"
            proxy_pass http://frontend:5000/;  
                                      # Проксируем на сервис frontend (порт 5000)
            proxy_set_header Host $host;                    # Передаём оригинальный домен
            proxy_set_header X-Real-IP $remote_addr;        # Настоящий IP пользователя
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # Цепочка IP-прокси
            proxy_set_header X-Forwarded-Proto $scheme;     # Протокол пользователя (http/https)
        }

        location /api/ {             # Все запросы, начинающиеся с /api/
            proxy_pass http://backend:3000/;  

            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;                          
        }
    }
}
